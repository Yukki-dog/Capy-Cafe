<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capy Caf√© ‚òï</title>
<style>
  body {
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    background: url('bg2.png') no-repeat center center fixed;
    background-size: cover;
    overflow: hidden;
  }
  #header {
    position: absolute;
    top:10px;
    left:10px;
    right:10px;
    display:flex;
    justify-content: space-between;
    align-items: center;
    color:white;
    font-size:18px;
    text-shadow: 1px 1px 4px black;
    z-index:10;
  }
  #clients {
    position:absolute;
    bottom:10px;
    left:10px;
    display:flex;
    gap:15px;
  }
  .client {
    width:100px;
    height:120px;
    background:#ccc;
    border-radius:15px;
    display:flex;
    flex-direction: column;
    align-items: center;
    justify-content:flex-end;
    cursor:pointer;
    position:relative;
  }
  .client-name {
    font-size:14px;
    color:black;
    margin-bottom:5px;
  }
  #orderBubble {
    position:absolute;
    bottom:130px;
    left:0;
    opacity:0;
    background:white;
    padding:5px 10px;
    border-radius:10px;
    border:1px solid black;
    font-size:14px;
    pointer-events:none;
    transition: all 0.5s ease;
  }
  #door {
    position:absolute;
    right:10px;
    top:50%;
    transform:translateY(-50%);
    width:150px;
    height:250px;
    background:#8B4513;
    border:3px solid black;
    border-radius:10px;
    cursor:pointer;
  }
  #acceptBtn, #declineBtn {
    width:80px;
    height:40px;
    margin:5px;
    cursor:pointer;
    font-weight:bold;
  }
  #buttons {
    position:absolute;
    bottom:10px;
    right:10px;
    display:flex;
    flex-direction: column;
    gap:5px;
  }
  #reviewsBtn {
    position:absolute;
    top:50px;
    right:10px;
    cursor:pointer;
    font-size:24px;
  }
  #reviewsPanel {
    position:absolute;
    top:80px;
    right:10px;
    width:300px;
    max-height:400px;
    background:rgba(255,255,255,0.9);
    border:1px solid black;
    overflow-y:auto;
    display:none;
    padding:10px;
    z-index:20;
  }
  .review {
    border-bottom:1px solid #888;
    padding:5px 0;
    font-size:14px;
  }
  #achievementsPanel {
    position:absolute;
    top:10px;
    left:50%;
    transform:translateX(-50%);
    background:rgba(255,255,255,0.9);
    border:1px solid black;
    padding:10px;
    display:none;
    z-index:20;
  }
</style>
</head>
<body>

<div id="header">
  <div id="balance">üí∞ $0</div>
  <div id="stars">‚≠ê 0</div>
</div>

<div id="clients"></div>

<div id="orderBubble"></div>

<div id="door" title="Go to kitchen"></div>

<div id="buttons">
  <button id="acceptBtn">‚úÖ Accept</button>
  <button id="declineBtn">‚ùå Decline</button>
</div>

<div id="reviewsBtn">üí¨</div>
<div id="reviewsPanel"></div>

<div id="achievementsPanel"></div>

<script>
  // ===== LocalStorage defaults =====
  if(!localStorage.balance) localStorage.balance=0;
  if(!localStorage.totalStars) localStorage.totalStars=0;
  if(!localStorage.totalClients) localStorage.totalClients=0;
  if(!localStorage.achievements) localStorage.achievements=JSON.stringify([]);
  if(!localStorage.reviews) localStorage.reviews=JSON.stringify([]);
  
  // ===== Clients =====
  const clientNames = ['–†—ç–Ω–¥–∏','–†—É–¥–∏','–ö–ª–∞—Ä–∞','–¢–æ–º','–°–∞—Ä–∞','–ú–∞–∫—Å','–õ–∏–∑–∞','–ù–∏–∫–æ'];
  const accessories = ['hat','dress','jacket','jewelry'];
  const drinks = ['Matcha','Tea','Coffee','Donut','Gingerbread'];

  let currentClient = null;

  const clientsDiv = document.getElementById('clients');
  const orderBubble = document.getElementById('orderBubble');
  const acceptBtn = document.getElementById('acceptBtn');
  const declineBtn = document.getElementById('declineBtn');
  const door = document.getElementById('door');
  const balanceDiv = document.getElementById('balance');
  const starsDiv = document.getElementById('stars');
  const reviewsBtn = document.getElementById('reviewsBtn');
  const reviewsPanel = document.getElementById('reviewsPanel');
  const achievementsPanel = document.getElementById('achievementsPanel');

  function randomName(){ return clientNames[Math.floor(Math.random()*clientNames.length)]; }
  function randomAccessory(){ return accessories[Math.floor(Math.random()*accessories.length)]; }
  function randomDrink(){ return drinks[Math.floor(Math.random()*drinks.length)]; }

  function createClient(){
    const div = document.createElement('div');
    div.className = 'client';
    const name = randomName();
    const accessory = randomAccessory();
    const drink = randomDrink();
    div.dataset.name=name;
    div.dataset.accessory=accessory;
    div.dataset.drink=drink;
    const nameDiv = document.createElement('div');
    nameDiv.className='client-name';
    nameDiv.innerText=name;
    div.appendChild(nameDiv);
    clientsDiv.appendChild(div);

    div.addEventListener('click', ()=>{
      currentClient = div.dataset;
      showOrderBubble(div);
    });
  }

  function showOrderBubble(clientDiv){
    orderBubble.innerText = clientDiv.dataset.drink;
    const rect = clientDiv.getBoundingClientRect();
    orderBubble.style.left=rect.left + 'px';
    orderBubble.style.bottom=(window.innerHeight - rect.top + 50)+'px';
    orderBubble.style.opacity=1;
  }

  for(let i=0;i<3;i++) createClient();

  // ===== Accept / Decline =====
  acceptBtn.addEventListener('click', ()=>{
    if(!currentClient) return;
    // Save current order to localStorage for kitchen
    localStorage.currentOrder = JSON.stringify(currentClient);
    alert('Go to kitchen to prepare this order!');
  });

  declineBtn.addEventListener('click', ()=>{
    if(!currentClient) return;
    const reviews = JSON.parse(localStorage.reviews);
    reviews.push({name:currentClient.name,stars:1,comment:"–ù–µ –ø—Ä–∏–Ω—è–ª–∏ –∑–∞–∫–∞–∑, –¥–µ–Ω–µ–≥ –Ω–µ—Ç"});
    localStorage.reviews = JSON.stringify(reviews);
    localStorage.totalStars = parseInt(localStorage.totalStars)+1; // —É–ø—Ä–æ—â–µ–Ω–Ω–æ
    updateUI();
    alert('Order declined. 1 star added.');
  });

  function updateUI(){
    balanceDiv.innerText='üí∞ $'+localStorage.balance;
    starsDiv.innerText='‚≠ê '+localStorage.totalStars;
  }

  updateUI();

  // ===== Door to kitchen =====
  door.addEventListener('click', ()=>{
    if(localStorage.currentOrder) window.location.href='kitchen.html';
    else alert('Accept an order first!');
  });

  // ===== Reviews panel =====
  reviewsBtn.addEventListener('click', ()=>{
    const reviews = JSON.parse(localStorage.reviews);
    reviewsPanel.innerHTML='';
    reviewsPanel.style.display = reviewsPanel.style.display==='none'?'block':'none';
    reviews.forEach(r=>{
      const div = document.createElement('div');
      div.className='review';
      div.innerHTML=`<b>${r.name}</b> ${'‚úÆ'.repeat(r.stars)}<br>${r.comment}`;
      reviewsPanel.appendChild(div);
    });
  });

  // ===== Achievements =====
  const achievementsList = [
    {name:'First Step',desc:'Complete first order',money:50},
    {name:'5 Stars!',desc:'Get perfect review',money:100},
    {name:'10 Clients',desc:'Serve 10 clients',money:200},
    {name:'100 Clients',desc:'Serve 100 clients',money:2000},
    {name:'Experimenter',desc:'Add 7+ ingredients',money:150},
    {name:'Empty Cup',desc:'Give empty cup',money:50},
    {name:'Unhappy Client',desc:'Fail 5 orders',money:200},
    {name:'Speedy Barista',desc:'Finish order <10s',money:300},
    {name:'Meditative Kettle',desc:'Boil water 5 times',money:100},
    {name:'Eat Everything',desc:'Use eat 20 times',money:100},
    {name:'Taster',desc:'Try all ingredients',money:400},
    {name:'Perfect Choice',desc:'Accept all orders 10 times',money:300},
    {name:'Picky',desc:'Decline 10 times',money:150},
    // secret
    {name:'Night Barista',desc:'Enter after midnight',money:250,secret:true},
    {name:'Double Boil',desc:'Boil again',money:150,secret:true},
    {name:'Barista Mischief',desc:'>20 marshmallows',money:500,secret:true},
    {name:'Capy in Hat',desc:'Serve client with hat perfectly',money:350,secret:true},
    {name:'Merciless',desc:'Kick 5 clients',money:200,secret:true},
  ];

  function checkAchievements(){
    const unlocked = JSON.parse(localStorage.achievements);
    achievementsList.forEach(a=>{
      if(!unlocked.includes(a.name)){
        // Simplified check, just unlock first step when first order exists
        if(a.name==='First Step' && localStorage.currentOrder){
          unlocked.push(a.name);
          localStorage.achievements = JSON.stringify(unlocked);
          showAchievement(a);
        }
      }
    });
  }

  function showAchievement(a){
    achievementsPanel.innerHTML=`üåü ${a.name} - ${a.desc} (+$${a.money})`;
    achievementsPanel.style.display='block';
    setTimeout(()=>{achievementsPanel.style.display='none';},4000);
  }

  checkAchievements();

</script>
</body>
</html>
