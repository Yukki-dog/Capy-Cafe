<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capy Café ☕</title>
<style>
  body {
    margin:0; padding:0;
    font-family: Arial, sans-serif;
    background: #f5f1e6;
    overflow: hidden;
  }
  #topbar {
    position: fixed;
    top:0; left:0;
    width:100%; height:60px;
    background:#c4aa60;
    display:flex; align-items:center; justify-content:space-between;
    padding:0 20px;
    z-index:10;
  }
  #topbar div {display:flex; align-items:center;}
  #topbar button {margin-left:10px; cursor:pointer; padding:5px;}
  #money, #stars {font-weight:bold; font-size:18px; margin-left:10px;}
  #commentsBtn {font-size:24px; cursor:pointer; margin-left:15px;}

  #cafe-container {
    position:relative;
    width:100%; height:100vh;
    display:flex; justify-content:center; align-items:center;
  }

  #door {
    width:150px; height:250px;
    background:#8B4513;
    cursor:pointer;
    display:flex; justify-content:center; align-items:center;
    color:white; font-weight:bold;
    position:absolute; right:50px; top:50%;
    transform:translateY(-50%);
  }

  .client {
    position:absolute;
    width:100px; height:150px;
    background:#ffd700;
    border-radius:50% 50% 20% 20%;
    display:flex; justify-content:center; align-items:flex-start;
    flex-direction:column;
    text-align:center;
    font-weight:bold;
  }

  .bubble {
    position:absolute;
    bottom:160px;
    left:50%;
    transform:translateX(-50%);
    padding:5px 10px;
    background:white;
    border-radius:10px;
    font-size:14px;
    animation:appear 0.5s forwards;
  }
  @keyframes appear {from{opacity:0; transform:translateX(-50%) translateY(10px);} to{opacity:1; transform:translateX(-50%) translateY(0);}}

  #orderPanel {
    position:fixed; bottom:20px; right:20px;
    background:#fff8dc; padding:10px;
    border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.3);
  }
  #orderText {font-weight:bold;}
  #orderButtons button {margin:5px; cursor:pointer; padding:5px 10px;}

  #achievements {
    position:fixed; top:80px; right:20px;
    background:#fffae6; padding:10px; border-radius:10px;
    max-width:200px; font-size:14px; display:none;
  }

  #commentsModal {
    position:fixed; top:50%; left:50%;
    transform:translate(-50%, -50%);
    background:white; padding:20px;
    border-radius:15px; box-shadow:0 0 10px rgba(0,0,0,0.4);
    display:none; z-index:20;
    max-height:70vh; overflow-y:auto;
  }
  #commentsModal h3 {margin-top:0;}
  #commentsModal button {margin-top:10px;}
</style>
</head>
<body>

<div id="topbar">
  <div>
    💰 <span id="money">0</span>
    ✮ <span id="stars">1</span>
  </div>
  <div>
    <button id="commentsBtn">💬</button>
    <button id="settingsBtn">⚙</button>
  </div>
</div>

<div id="cafe-container">
  <div id="door">Door</div>
</div>

<div id="orderPanel">
  <div id="orderText">No order</div>
  <div id="orderButtons">
    <button id="acceptBtn">Accept</button>
    <button id="declineBtn">Decline</button>
  </div>
</div>

<div id="achievements"></div>

<div id="commentsModal">
  <h3>Comments</h3>
  <div id="commentsList"></div>
  <button id="closeComments">Close</button>
</div>

<script>
let money = Number(localStorage.getItem("money")||0);
let stars = Number(localStorage.getItem("stars")||1);
let clientsServed = Number(localStorage.getItem("clientsServed")||0);
let achievementsUnlocked = JSON.parse(localStorage.getItem("achievementsUnlocked")||"[]");

const moneyEl = document.getElementById("money");
const starsEl = document.getElementById("stars");
const cafeContainer = document.getElementById("cafe-container");
const door = document.getElementById("door");
const orderText = document.getElementById("orderText");
const acceptBtn = document.getElementById("acceptBtn");
const declineBtn = document.getElementById("declineBtn");
const achievementsEl = document.getElementById("achievements");
const commentsModal = document.getElementById("commentsModal");
const commentsList = document.getElementById("commentsList");
const commentsBtn = document.getElementById("commentsBtn");
const closeComments = document.getElementById("closeComments");

// === Clients logic ===
const orders = ["Matcha", "Tea", "Coffee"];
let currentClient = null;

function generateRandomName() {
  const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  let name = letters[Math.floor(Math.random()*letters.length)];
  name += letters[Math.floor(Math.random()*letters.length)];
  return name;
}

function createClient() {
  if(currentClient) currentClient.remove();
  const client = document.createElement("div");
  client.classList.add("client");
  const name = generateRandomName();
  client.dataset.name = name;
  client.innerHTML = `<div>${name}</div><div class="bubble">${orders[Math.floor(Math.random()*orders.length)]}</div>`;
  client.style.left = (Math.random()*50+10)+"%";
  client.style.top = (Math.random()*40+40)+"%";
  cafeContainer.appendChild(client);
  currentClient = client;
}

door.addEventListener("click", ()=> {
  createClient();
  // show order panel
  orderText.textContent = currentClient.querySelector(".bubble").textContent;
});

// === Accept / Decline ===
acceptBtn.addEventListener("click", ()=>{
  if(!currentClient) return;
  money += 50;
  clientsServed += 1;
  // stars logic
  stars = Math.min(5, stars+1); // упрощенно
  updateUI();
  unlockAchievements();
  currentClient.remove();
  currentClient = null;
  orderText.textContent = "No order";
});

declineBtn.addEventListener("click", ()=>{
  if(!currentClient) return;
  stars = Math.max(1, stars-1);
  updateUI();
  addComment(`${currentClient.dataset.name} ✮ 1 - не приняли заказ`);
  currentClient.remove();
  currentClient = null;
  orderText.textContent = "No order";
});

function updateUI(){
  moneyEl.textContent = money;
  starsEl.textContent = stars;
  localStorage.setItem("money", money);
  localStorage.setItem("stars", stars);
  localStorage.setItem("clientsServed", clientsServed);
}

function addComment(text){
  let comments = JSON.parse(localStorage.getItem("comments")||"[]");
  comments.push(text);
  localStorage.setItem("comments", JSON.stringify(comments));
}

commentsBtn.addEventListener("click", ()=>{
  commentsList.innerHTML = "";
  let comments = JSON.parse(localStorage.getItem("comments")||"[]");
  comments.forEach(c=>{
    const div = document.createElement("div");
    div.textContent = c;
    commentsList.appendChild(div);
  });
  commentsModal.style.display = "block";
});
closeComments.addEventListener("click", ()=>commentsModal.style.display="none");

// === Achievements ===
const allAchievements = [
  {name:"First Step", condition:()=>clientsServed>=1, reward:50},
  {name:"5 Stars!", condition:()=>stars===5, reward:100},
  {name:"10 Clients", condition:()=>clientsServed>=10, reward:200},
];

function unlockAchievements(){
  allAchievements.forEach(a=>{
    if(a.condition() && !achievementsUnlocked.includes(a.name)){
      achievementsUnlocked.push(a.name);
      localStorage.setItem("achievementsUnlocked", JSON.stringify(achievementsUnlocked));
      money += a.reward;
      showAchievement(a.name);
      updateUI();
    }
  });
}

function showAchievement(name){
  achievementsEl.textContent = `🏆 ${name}!`;
  achievementsEl.style.display="block";
  setTimeout(()=>achievementsEl.style.display="none", 3000);
}

// === Initial UI ===
updateUI();

</script>
</body>
</html>
