<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Capy Caf√© ‚òï</title>
<style>
  body {
    margin:0;
    padding:0;
    font-family: Arial, sans-serif;
    background: url('bg2.png') no-repeat center center fixed;
    background-size: cover;
    overflow: hidden;
  }
  #topBar {
    position: fixed;
    top: 10px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 20px;
    z-index: 10;
    font-size: 18px;
    color: #fff;
    text-shadow: 1px 1px 3px #000;
  }
  #balance { font-weight: bold; }
  #stars { font-weight: bold; }
  #clientArea {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    text-align: center;
  }
  #clientImg {
    width: 120px; height: 120px;
    background-color: #aaa;
    border-radius: 50%;
    display: inline-block;
    margin-bottom: 10px;
  }
  #orderBubble {
    display: inline-block;
    padding: 10px 15px;
    background: #fff;
    border-radius: 15px;
    margin-bottom: 10px;
    font-weight: bold;
  }
  .actionBtn {
    width: 80px;
    height: 80px;
    margin: 0 10px;
    cursor: pointer;
    transition: transform 0.2s;
  }
  .actionBtn:hover { transform: scale(1.1); }

  #doorBtn {
    position: absolute;
    top: 50%;
    right: 50px;
    width: 150px;
    height: 250px;
    background-color: #bbb;
    border-radius: 10px;
    cursor: pointer;
  }

  #overlay, #settingsModal, #achieveModal, #reviewsPanel {
    position: fixed;
    top:0; left:0;
    width:100%; height:100%;
    display:none;
    justify-content:center;
    align-items:center;
    z-index:100;
  }

  #overlay { background: rgba(0,0,0,0.5); }
  #settingsModal, #achieveModal, #reviewsPanel {
    background: #fff;
    border-radius: 20px;
    padding: 30px;
    width: 700px;
    max-width: 90%;
    box-shadow: 0 0 20px rgba(0,0,0,0.3);
  }

  #achieveModal img { width: 150px; display:block; margin: 0 auto 10px; }
  #reviewsList { max-height: 300px; overflow-y: auto; margin-top: 10px; }
  .reviewItem { border-bottom:1px solid #ccc; margin-bottom:5px; padding-bottom:5px; }
  #closeReviews, #closeAchieve, #closeSettings { cursor:pointer; margin-top: 15px; padding: 8px 15px; border:none; border-radius:10px; background:#e0c097; transition:0.2s; }
  #closeReviews:hover, #closeAchieve:hover, #closeSettings:hover { background:#d4ab7c; }

  .slider-container { margin:15px 0; }
  .slider-container label { display:block; font-size:16px; margin-bottom:5px; }
  input[type=range] { width:100%; }

</style>
</head>
<body>

<div id="topBar">
  <div id="balance">üí∞ 0$</div>
  <div id="stars">‚≠ê 0</div>
  <button id="reviewsBtn">üí¨</button>
  <button id="settingsBtn">‚öôÔ∏è</button>
</div>

<div id="clientArea">
  <div id="clientImg"></div>
  <div id="orderBubble">---</div>
  <div>
    <img src="accept.png" class="actionBtn" id="acceptBtn">
    <img src="decline.png" class="actionBtn" id="declineBtn">
  </div>
</div>

<div id="doorBtn" title="Go to Kitchen"></div>

<!-- Overlay -->
<div id="overlay"></div>

<!-- Settings Modal -->
<div id="settingsModal">
  <h3>Settings</h3>
  <div class="slider-container">
    <label for="musicSlider">Music</label>
    <input type="range" id="musicSlider" min="0" max="100">
  </div>
  <div class="slider-container">
    <label for="soundSlider">Sound</label>
    <input type="range" id="soundSlider" min="0" max="100">
  </div>
  <button id="closeSettings">Close</button>
</div>

<!-- Achieve Modal -->
<div id="achieveModal">
  <img src="" id="achieveImg" alt="Achieve">
  <div id="achieveTitle"></div>
  <button id="closeAchieve">Close</button>
</div>

<!-- Reviews Panel -->
<div id="reviewsPanel">
  <h3>Reviews</h3>
  <div id="reviewsList"></div>
  <button id="closeReviews">Close</button>
</div>

<audio id="clickSound" src="click.wav"></audio>

<script>
let balance = parseInt(localStorage.getItem("cafeBalance")) || 0;
let totalStars = parseFloat(localStorage.getItem("cafeStars")) || 0;
let ordersServed = parseInt(localStorage.getItem("ordersServed")) || 0;

const balanceEl = document.getElementById("balance");
const starsEl = document.getElementById("stars");
const clientImg = document.getElementById("clientImg");
const orderBubble = document.getElementById("orderBubble");
const acceptBtn = document.getElementById("acceptBtn");
const declineBtn = document.getElementById("declineBtn");
const doorBtn = document.getElementById("doorBtn");

const overlay = document.getElementById("overlay");
const settingsModal = document.getElementById("settingsModal");
const closeSettings = document.getElementById("closeSettings");
const musicSlider = document.getElementById("musicSlider");
const soundSlider = document.getElementById("soundSlider");

const achieveModal = document.getElementById("achieveModal");
const achieveImg = document.getElementById("achieveImg");
const achieveTitle = document.getElementById("achieveTitle");
const closeAchieve = document.getElementById("closeAchieve");

const reviewsPanel = document.getElementById("reviewsPanel");
const reviewsBtn = document.getElementById("reviewsBtn");
const closeReviews = document.getElementById("closeReviews");
const reviewsList = document.getElementById("reviewsList");

const clickSound = document.getElementById("clickSound");

// ===== Client Logic =====
const drinks = ["–º–∞—Ç—á—É","—á–∞–π","–∫–æ—Ñ–µ"];
const clients = ["–ö–∞–ø–∏","–ë—É–±—É","–ú–∏–º–∏","–¢–æ—Ç–æ","–ù–∞–ª–∞"];
let currentClient = null;
let currentOrder = null;

function randomClient(){
  const name = clients[Math.floor(Math.random()*clients.length)];
  const drink = drinks[Math.floor(Math.random()*drinks.length)];
  currentClient = name;
  currentOrder = drink;
  clientImg.style.backgroundColor = "#"+Math.floor(Math.random()*16777215).toString(16);
  orderBubble.textContent = drink;
}
randomClient();

// ===== Update UI =====
function updateUI(){
  balanceEl.textContent = `üí∞ ${balance}$`;
  starsEl.textContent = `‚≠ê ${totalStars.toFixed(1)}`;
}

// ===== Accept / Decline Orders =====
acceptBtn.addEventListener("click",()=>{
  clickSound.play();
  // Move to kitchen.html to prepare order
  localStorage.currentClient = currentClient;
  localStorage.currentOrder = currentOrder;
  window.location.href="kitchen.html";
});

declineBtn.addEventListener("click",()=>{
  clickSound.play();
  // Feedback comment
  let comment = `–ú—ñ–π –∑–∞–∫–∞–∑ –Ω–µ –ø—Ä–∏–π–Ω—è–ª–∏, —Å–∫–∞–∑–∞–ª–∏ "–Ω—ñ"... –ê —è –ø—Ä–æ—Å—Ç–æ —Ö–æ—Ç—ñ–ª–∞ ${currentOrder}!`;
  let reviews = JSON.parse(localStorage.getItem("reviews")||"[]");
  reviews.push({name:currentClient, stars:0, comment:comment});
  localStorage.setItem("reviews",JSON.stringify(reviews));
  randomClient();
});

// ===== Door to Kitchen =====
doorBtn.addEventListener("click",()=>{
  window.location.href="kitchen.html";
});

// ===== Settings =====
function openSettings(){
  overlay.style.display="flex";
  settingsModal.style.display="flex";
}
function closeSettingsFunc(){
  overlay.style.display="none";
  settingsModal.style.display="none";
}
settingsBtn.addEventListener("click",openSettings);
closeSettings.addEventListener("click",closeSettingsFunc);
overlay.addEventListener("click",closeSettingsFunc);

musicSlider.value = localStorage.musicVolume || 85;
soundSlider.value = localStorage.soundVolume || 100;

// ===== Achievements =====
const achievements = {
  "–ü–µ—Ä–≤—ã–π —à–∞–≥":{cond:()=>ordersServed>=1, reward:50},
  "5 –∑–≤—ë–∑–¥–æ—á–µ–∫!":{cond:()=>totalStars>=5, reward:100},
  "10 –∫–ª–∏–µ–Ω—Ç–æ–≤":{cond:()=>ordersServed>=10, reward:200}
  // –î–æ–±–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∞—á–∏–≤–∫–∏ –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
};

function checkAchievements(){
  for(let key in achievements){
    if(!localStorage.getItem("ach_"+key) && achievements[key].cond()){
      balance += achievements[key].reward;
      localStorage.setItem("cafeBalance",balance);
      localStorage.setItem("ach_"+key,"done");
      achieveImg.src="achieve_placeholder.png";
      achieveTitle.textContent = key;
      achieveModal.style.display="flex";
      overlay.style.display="flex";
      updateUI();
    }
  }
}
closeAchieve.addEventListener("click",()=>{
  achieveModal.style.display="none";
  overlay.style.display="none";
});

// ===== Reviews =====
reviewsBtn.addEventListener("click",()=>{
  reviewsPanel.style.display="flex";
  overlay.style.display="flex";
  const reviews = JSON.parse(localStorage.getItem("reviews")||"[]");
  reviewsList.innerHTML="";
  reviews.forEach(r=>{
    const div = document.createElement("div");
    div.classList.add("reviewItem");
    div.innerHTML=`<strong>${r.name}</strong> - ${r.stars}‚≠ê<br>${r.comment}`;
    reviewsList.appendChild(div);
  });
});
closeReviews.addEventListener("click",()=>{
  reviewsPanel.style.display="none";
  overlay.style.display="none";
});

// ===== Update UI on load =====
updateUI();
checkAchievements();

</script>

</body>
</html>
